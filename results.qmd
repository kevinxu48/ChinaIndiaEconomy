# Results

### Temporary Headings. Replace with something meaningful that summarizes the plots we create

```{r}
#packages and helper functions 
library(maps)
library(mapproj)
library(sf)
library(viridis)
library(gridExtra)
library(ggthemes)
library(tidyr)
library(tidyverse)
library(ggplot2)
library(scales)
library(dplyr)

kv_theme <- function (){
  theme_minimal() %+replace%
    theme(legend.title = element_blank(),
          plot.title = element_text(
            size = 12,
            face = 'bold',
            hjust = 0,
            vjust = 0))
}
```

```{r}
inflation <- read.csv("inflation.csv", header = TRUE, check.names = FALSE)
inflation <- pivot_longer(inflation, cols='1960':'2022', names_to = "year", values_to = "inflation") %>%
  mutate(year = as.integer(year)) %>% filter(year >= 1989)
inflation <- inflation %>%
  arrange(year) %>%
  group_by(`Country Name`) %>%
  mutate(inf_change = (((inflation - lag(inflation)) /lag(inflation)) *100)) %>%
  filter(`Country Name` %in% c("China", "India")) %>% rename(Country = `Country Name`) %>%
  select(Country, year, inf_change)

unemp <- read.csv("unemployment.csv", header = TRUE, check.names = FALSE)
unemp <- pivot_longer(unemp, cols='1960':'2022', names_to = "year", values_to = "unemployment") %>%
  mutate(year = as.integer(year)) %>% filter(year >= 1989)
unemp <- unemp %>%
  arrange(year) %>%
  group_by(Country) %>%
  mutate(unemp_change = (((unemployment - lag(unemployment)) /lag(unemployment)) *100)) %>%
  filter(Country %in% c("China", "India")) %>%
  select(Country, year, unemp_change)

GDP_growth <- read.csv("GDP_growth.csv", header = TRUE, check.names = FALSE)
GDP_growth <- pivot_longer(GDP_growth, cols='1960':'2022', names_to = "year", values_to = "GDPgrowth") %>%
  mutate(year = as.integer(year), GDPgrowth = (GDPgrowth)) %>%
  filter(year >= 1989) %>% rename(Country = `Country Name`) %>%
  select(Country, year, GDPgrowth)

#Year-over-year comparison of key economic factors
yoy_comp <- GDP_growth %>%
  merge(inflation, by = c("Country", "year")) %>%
  merge(unemp, by = c("Country", "year")) %>%
  mutate(Country = as.factor(Country)) %>% 
  rename(GDP = GDPgrowth, `Unemployment Rate` = unemp_change, Inflation = inf_change)

yoy_comp <- pivot_longer(yoy_comp, cols='GDP':'Unemployment Rate', names_to = "indicator", values_to = "value")

yoyc_China <- yoy_comp %>% filter(year >= 2019 & Country == "China") %>%
  ggplot() +
  geom_col(aes(x = year, y = value, fill = indicator), position = "dodge") +
  scale_fill_brewer(palette = "YlOrRd") + 
  kv_theme() + 
  labs(x = "", y = "(%)", title = "China")

yoyc_India <- yoy_comp %>% filter(year >= 2019 & Country == "India") %>%
  ggplot() +
  geom_col(aes(x = year, y = value, fill = indicator), position = "dodge") +
  scale_fill_brewer(palette = "YlGn") + 
  kv_theme() + 
  labs(x = "", y = "(%)", title = "India")

grid.arrange(yoyc_China, yoyc_India, top = "Year over year changes in key economic indicators")

```

## How have China and India's growth stories differed?
```{r}


GDP_values = read.csv("GDP_values.csv")
GDP_vals = GDP_values[((GDP_values$`Country.Name` == 'China')| (GDP_values$`Country.Name` == 'India')), ]
L = pivot_longer(GDP_vals,cols='X1960':'X2022', names_to = "year", values_to = "GDP per Cap")
L$year<-gsub("X","",as.character(L$year))
L$year <- as.integer(L$year)


GDP_vals = L[c("Country.Name", "Indicator.Name", "year", "GDP per Cap")]
GDP_vals = GDP_vals %>% rename(Country = `Country.Name`)

GDP_growth = read.csv("GDP.csv")
GDP_growth = GDP_growth[((GDP_growth$`Country.Name` == 'China')| (GDP_growth$`Country.Name` == 'India')) |  (GDP_growth$`Country.Name` == 'United States'), ]
L = pivot_longer(GDP_growth,cols='X1961':'X2022', names_to = "year", values_to = "GDP Growth %")

L$year<-gsub("X","",as.character(L$year))
L$year <- as.integer(L$year)

GDP_growth = L[c("Country.Name", "Indicator.Name", "year", "GDP Growth %")]
GDP_growth = GDP_growth %>% rename(Country = "Country.Name")
```

```{r,fig.width=15}
ggplot(GDP_vals, aes(year,`GDP per Cap`)) +
  geom_point(color = "Black") +
  stat_smooth(method = "loess", se = FALSE, span = 0.5)+
  facet_wrap(Country~.)+
  ylab("GDP Per Capita (US$)")+
  xlab("Year")+ 
  theme(axis.text.x = element_text(angle = 80, vjust=0.5))+
  ggtitle("Historically China has Significantly Higher GDP Per Capita")+ 
  theme(plot.title = element_text(hjust = 0.5))
```
Gross domestic product (GDP) per capita is a metric that describes a country's economic output per person, so a high value indicates a stronger economy; GDP per capita is also a better measure for comparing overall economy than nominal GDP because it takes into account because it takes population size into account, which is especially important for China and India because they are the two most populous countries in the world. From this scatterplot with fitted line, we see that while both China and India have had growing GDP per capita levels since 1960, since 2000 China's has skyrocketed compared to India's. As of 2020, the difference between their GDP per Capita is over $10000. When looking at GDP growth without considering other factors, it appears that if current trends continue, it will take many years for India's GDP per Capita to surpass China's.


```{r,fig.width=15}
ggplot(GDP_growth, aes(year,Country, fill = `GDP Growth %`)) +
  geom_tile(color = "Black") +
   theme_minimal() +
  theme(axis.text.x = element_text(angle = 80, vjust=0.5))+
  ggtitle("China's GDP has Generally Grown Faster than India's since 1960")+ 
  scale_fill_gradient2(
    low = muted("orange"),
    mid = "white",
    high = muted("green"),
    midpoint = 0
  )+
  theme(plot.title = element_text(hjust = 0.5))
```
We use the United States' GDP growth as a benchmark for comparison because it is considered the largest economy in the world because it has the highest nominal GDP out of any country.


### What is the reasoning for these differences?
Parallel coordinates

2 way bar chart with exports going one direction and imports going the other direction

```{r}
exports = read.csv("exports.csv")
imports = read.csv("imports.csv")

exports = exports[((exports$`Country.Name` == 'China')| (exports$`Country.Name` == 'India')), ]
L = pivot_longer(exports,cols='X1961':'X2022', names_to = "year", values_to = "Exports")

L$year<-gsub("X","",as.character(L$year))
L$year <- as.integer(L$year)

exports = L[c("Country.Name", "Indicator.Name", "year", "Exports")]
exports = exports %>% rename(Country = "Country.Name")
exports$Exports = exports$Exports/(10**9)
imports = imports[((imports$`Country.Name` == 'China')| (imports$`Country.Name` == 'India')), ]
L = pivot_longer(imports,cols='X1961':'X2022', names_to = "year", values_to = "Imports")

L$year<-gsub("X","",as.character(L$year))
L$year <- as.integer(L$year)

imports = L[c("Country.Name", "Indicator.Name", "year", "Imports")]
imports = imports %>% rename(Country = "Country.Name")
# make imports negative value for plot
imports$Imports = imports$Imports/(-10**9)

importexports = merge(exports,imports,by=c("Country","year"))
pivotimportexports = pivot_longer(importexports, cols=c("Exports","Imports"), names_to = "type",values_to = "value")
```

```{r}
ggplot(pivotimportexports,aes(x=year,y=value,fill=type))+
    geom_bar(stat="identity")+
    xlab("year")+
    ylab("Amount spent on Imports/Exports (Billion $USD)")+
    facet_wrap(Country~.,scales="free_y")+
  coord_flip()+ 
  scale_fill_manual(values = c("seagreen3", "red3"))+
  theme(axis.text.x = element_text(angle = 80, vjust=0.5))+
  ggtitle("China has Significantly Higher Amounts Imported and Exported")+ 
  theme(plot.title = element_text(hjust = 0.5))
```
## How do their historical trends set them up for the future?


## How do Climate-related Challenges Impact Economy?

```{r}
ghg <- read.csv("historical_emissions.csv", header = TRUE, check.names = FALSE)
ghg$`1990` <- as.numeric(ghg$`1990`)
ghg$Country <- as.factor(ghg$Country)
ghg <- pivot_longer(ghg, cols='2020':'1990', names_to = "year", values_to = "emissions")
world <- map_data("world") %>% filter(! long > 180)
world <- world %>% rename(Country = region) %>% mutate(Country = factor(Country))
diff <- setdiff(world$Country, ghg$Country)

world <- world %>% mutate(Country = recode(str_trim(Country),
                                          "USA" = "United States", "UK" = "United Kingdom",
                                          "Turkey" = "TÃ¼rkiye", "Trinidad" = "Trinidad and Tobago"))
ghg_2019 <- ghg %>% filter(year == 2019)
world_ghg <- inner_join(world, ghg_2019, by = "Country")

global_emit <- ggplot(data = world_ghg, mapping = aes(x = long, y = lat, group = group)) +
  coord_fixed(1.3) +
  geom_polygon(aes(fill = emissions)) +
  scale_fill_viridis() +
  ggtitle("Global greenhouse gas emissions in 2019 (metric tons)") +
  kv_theme() +
  theme(axis.text = element_blank(),
        axis.line = element_blank(),
        axis.ticks = element_blank(),
        panel.border = element_blank(),
        panel.grid = element_blank(),
        axis.title = element_blank(),
        plot.title = element_text(margin = margin(b = 20))) +
  coord_map("moll")
global_emit

```

```{r}
gain <- read.csv("gain.csv", header = TRUE, check.names = FALSE)
ghg <- read.csv("historical_emissions.csv", header = TRUE, check.names = FALSE)

gain <- pivot_longer(gain,cols='1995':'2021', names_to = "year", values_to = "score")
ghg$`1990` <- as.numeric(ghg$`1990`)
ghg$Country <- as.factor(ghg$Country)
ghg <- pivot_longer(ghg, cols='2020':'1990', names_to = "year", values_to = "emissions")

ghg_CI <- ghg %>% filter(Country %in% c("India", "China"))
gain_CI <- gain %>% filter(Name %in% c("India", "China"))

gain_CI$Name <- as.factor(gain_CI$Name)
gain_CI$year <- as.integer(gain_CI$year)
gain_CI <- gain_CI %>% mutate(Country = Name) %>% group_by(Country) %>% select(-Name)

ghg_CI$Country <- as.factor(ghg_CI$Country)
ghg_CI$year <- as.integer(ghg_CI$year)
ghg_CI <- ghg_CI %>% group_by(Country)

custom_colors <- c("China" = "red", "India" = "green4")
merge1 <- merge(ghg_CI, gain_CI, by = c("year", "Country")) %>%
  select(year, Country, emissions, score) %>% 
  mutate(score = scale(score), emissions = scale(emissions))

merge1 <- pivot_longer(merge1,cols='emissions':'score', names_to = "variable", values_to = "value")

merge1 %>% group_by(Country, variable) %>%
  ggplot() + geom_line(aes(x = year, y = value, color = Country, linetype = variable),linewidth = 1) +
  scale_color_manual(values = custom_colors) +
  kv_theme() + 
  labs(x = "", y = "", title = "GHG emissions versus ND-Gain score over time")
```

```{r}
gain_21 <- gain %>% filter(year >= 1995) %>% na.omit()

quantiles <- quantile(gain_21$score, probs = c(0, 1/3, 2/3, 1))
gain_21$score_cat <- cut(gain_21$score,
                         breaks = quantiles,
                         labels = c("Low", "Medium", "High"))

gain_21 %>% filter(Name %in% G20) %>% 
  ggplot(aes(year, Name, fill = score_cat)) + 
    geom_tile(alpha = 0.95) + kv_theme() +
  scale_fill_manual(values=c('#ffffd4','#fe9929','#993404')) + 
  scale_x_continuous(breaks = seq(min(gain_21$year), max(gain_21$year), by = 2)) +   labs(x = "", y = "", title = "ND-Gain index scores over time - G20 countries") +  theme(plot.title = element_text(margin = margin(b = 10)))


```

    Maybe do a mosaic plot with 2 splits: CO2 emissions and economic policies vs GDP per capita
    
    
Bar chart with imports going i
